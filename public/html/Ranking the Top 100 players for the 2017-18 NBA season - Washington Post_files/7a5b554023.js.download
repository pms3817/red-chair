(function($){$.fn.jqm=function(options){return this.each(function(){var e=$(this),jqm=e.data("jqm")||$.extend({ID:I++},$.jqm.params),o=$.extend(jqm,options);e.data("jqm",o).addClass("jqm-init");o.trigger&&e.jqmAddTrigger(o.trigger)})};$.fn.jqmAddTrigger=function(trigger){return this.each(function(){if(!addTrigger($(this),"jqmShow",trigger))err("jqmAddTrigger must be called on initialized modals")})};$.fn.jqmAddClose=function(trigger){return this.each(function(){if(!addTrigger($(this),"jqmHide",trigger))err("jqmAddClose must be called on initialized modals")})};
$.fn.jqmShow=function(trigger){return this.each(function(){!this._jqmShown&&show($(this),trigger)})};$.fn.jqmHide=function(trigger){return this.each(function(){this._jqmShown&&hide($(this),trigger)})};var err=function(msg){if(window.console&&window.console.error)window.console.error(msg)},show=function(e,t){var o=e.data("jqm"),t=t||window.event,z=parseInt(e.css("z-index")),z=z>0?z:Math.pow(2,27),v=$("\x3cdiv\x3e\x3c/div\x3e").addClass(o.overlayClass).css({height:"100%",width:"100%",position:"fixed",
left:0,top:0,"z-index":z-1,opacity:o.overlay/100}),h={w:e,c:o,o:v,t:t};e.css("z-index",z);if(o.ajax){var target=o.target||e,url=o.ajax;target=typeof target=="string"?$(target,e):$(target);if(url.substr(0,1)=="@")url=$(t).attr(url.substring(1));target.html(o.ajaxText).on("load",url,function(){o.onLoad&&o.onLoad.call(this,h);open(h)})}else open(h)},hide=function(e,t){var o=e.data("jqm"),t=t||window.event,h={w:e,c:o,o:e.data("jqmv"),t:t};close(h)},onShow=function(hash){if(hash.c.overlay>0)hash.o.prependTo("body");
hash.w.show();$.jqm.focusFunc(hash.w);return true},onHide=function(hash){hash.w.hide()&&hash.o&&hash.o.remove();return true},addTrigger=function(e,key,trigger){var jqm=e.data("jqm");if(!e.data("jqm"))return false;return $(trigger).each(function(){this[key]=this[key]||[];if($.inArray(jqm.ID,this[key])<0){this[key].push(jqm.ID);$(this).click(function(){var trigger=this;e[key](this);return false})}})},open=function(h){var e=h.w,v=h.o,o=h.c;if(o.onShow(h)!==false){e[0]._jqmShown=true;if(o.modal){!A[0]&&
F("bind");A.push(e)}else e.jqmAddClose(v);o.closeClass&&e.jqmAddClose($("."+o.closeClass,e));o.toTop&&v&&e.before('\x3cspan id\x3d"jqmP'+o.ID+'"\x3e\x3c/span\x3e').insertAfter(v);e.data("jqmv",v)}},close=function(h){var e=h.w,v=h.o,o=h.c;if(o.onHide(h)!==false){e[0]._jqmShown=false;if(o.modal){A.pop();!A[0]&&F("unbind")}o.toTop&&v&&$("#jqmP"+o.ID).after(e).remove()}},F=function(t){$(document)[t]("keypress keydown mousedown",X)},X=function(e){var modal=$(e.target).data("jqm")||$(e.target).parents(".jqm-init:first").data("jqm"),
activeModal=A[A.length-1].data("jqm");if(modal&&modal.ID==activeModal.ID)return true;return $.jqm.focusFunc(activeModal)},I=0,A=[];$.jqm={params:{overlay:50,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:false,target:false,ajaxText:"",modal:false,toTop:false,onShow:onShow,onHide:onHide,onLoad:false},focusFunc:function(e){$(":input:visible:first",e).focus();return false}}})(window.Zepto||window.jQuery);